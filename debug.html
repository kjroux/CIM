<!DOCTYPE html>
<html>
<head>
  <title>Debug CIM App</title>
  <style>
    body {
      font-family: monospace;
      padding: 20px;
      background: #f5f5f5;
    }
    .section {
      background: white;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 8px;
      border: 1px solid #ddd;
    }
    h2 { margin-top: 0; color: #1A73E8; }
    button {
      padding: 10px 20px;
      margin: 5px;
      background: #EA4335;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    button:hover { background: #D33B2C; }
    .success { color: #34A853; font-weight: bold; }
    .error { color: #EA4335; font-weight: bold; }
    pre { background: #f0f0f0; padding: 10px; border-radius: 4px; }
  </style>
</head>
<body>
  <h1>CIM Training App - Debug Console</h1>

  <div class="section">
    <h2>1. LocalStorage Status</h2>
    <div id="storage-status"></div>
    <button onclick="clearStorage()">Clear LocalStorage & Reload</button>
  </div>

  <div class="section">
    <h2>2. Date Calculations</h2>
    <div id="date-calc"></div>
  </div>

  <div class="section">
    <h2>3. Program Data</h2>
    <div id="program-data"></div>
  </div>

  <script src="/js/data.js"></script>
  <script src="/js/storage.js"></script>
  <script src="/js/app.js"></script>

  <script>
    // 1. Check localStorage
    function checkStorage() {
      const data = localStorage.getItem('cim_user_data');
      let html = '';

      if (data) {
        try {
          const parsed = JSON.parse(data);
          html += '<p><strong>Start Date:</strong> ' + parsed.startDate + '</p>';
          html += '<p><strong>Logs Count:</strong> ' + Object.keys(parsed.logs || {}).length + '</p>';
          html += '<p><strong>Raw Data:</strong></p>';
          html += '<pre>' + JSON.stringify(parsed, null, 2).substring(0, 500) + '...</pre>';
        } catch (e) {
          html += '<p class="error">Error parsing localStorage: ' + e.message + '</p>';
        }
      } else {
        html += '<p class="error">No data in localStorage</p>';
      }

      document.getElementById('storage-status').innerHTML = html;
    }

    // 2. Test date calculations
    function testDates() {
      Storage.initUserData();
      const startDate = Storage.getStartDate();

      let html = '<p><strong>Expected Start Date:</strong> 2026-02-02 (Monday)</p>';
      html += '<p><strong>Actual Start Date:</strong> ' + startDate + '</p>';

      if (startDate !== '2026-02-02') {
        html += '<p class="error">❌ WRONG! Start date should be 2026-02-02</p>';
      } else {
        html += '<p class="success">✓ Correct start date</p>';
      }

      html += '<hr><h3>Test Dates:</h3>';

      const testDates = [
        '2026-01-25',  // Today
        '2026-02-02',  // Week 1 Day 1
        '2026-02-03',  // Week 1 Day 2
        '2026-02-09',  // Week 2 Day 1
      ];

      testDates.forEach(date => {
        const info = App.getProgramInfo(date);
        const workout = App.getScheduledWorkout(date);

        html += '<div style="margin: 10px 0; padding: 10px; background: #f9f9f9; border-left: 3px solid #1A73E8;">';
        html += '<strong>' + date + '</strong><br>';
        html += 'Status: ' + info.status + '<br>';
        html += 'Week: ' + info.week + ', Day: ' + info.dayOfWeek + '<br>';
        html += 'Phase: ' + info.phase + '<br>';
        html += 'Workout: ' + (workout ? workout.name : 'NONE') + '<br>';
        html += '</div>';
      });

      document.getElementById('date-calc').innerHTML = html;
    }

    // 3. Check program data
    function checkProgramData() {
      let html = '<p><strong>Phases loaded:</strong> ' + PROGRAM.phases.length + '</p>';
      html += '<p><strong>Phase 1 name:</strong> ' + PROGRAM.phases[0].name + '</p>';
      html += '<p><strong>Phase 1 Day 1:</strong> ' + PROGRAM.phases[0].weekTemplate[1].name + '</p>';
      document.getElementById('program-data').innerHTML = html;
    }

    function clearStorage() {
      if (confirm('This will delete all your logged workouts. Continue?')) {
        localStorage.clear();
        alert('Storage cleared! Reloading...');
        location.reload();
      }
    }

    // Run checks
    checkStorage();
    testDates();
    checkProgramData();
  </script>
</body>
</html>
