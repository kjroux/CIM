<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="theme-color" content="#B31921">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="CIM Training">

  <title>CIM Marathon Training</title>

  <link rel="manifest" href="./manifest.json">
  <link rel="stylesheet" href="./css/styles.css">

  <!-- Icons -->
  <link rel="icon" type="image/png" sizes="192x192" href="./icons/icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="./icons/icon-512.png">
  <link rel="apple-touch-icon" href="./icons/icon-192.png">
</head>
<body>
  <div id="app">
    <main id="main-content">
      <!-- Content will be dynamically rendered here -->
      <div style="padding: 40px 20px; text-align: center; color: #757575;">
        <p>Loading...</p>
      </div>
    </main>

    <nav class="bottom-nav">
      <button class="nav-item active" data-view="today">
        <span class="nav-icon">ğŸ“…</span>
        <span>Today</span>
      </button>
      <button class="nav-item" data-view="week">
        <span class="nav-icon">ğŸ“Š</span>
        <span>Week</span>
      </button>
      <button class="nav-item" data-view="library">
        <span class="nav-icon">ğŸ’ª</span>
        <span>Library</span>
      </button>
      <button class="nav-item" data-view="running">
        <span class="nav-icon">ğŸƒ</span>
        <span>Running</span>
      </button>
      <button class="nav-item" data-view="settings">
        <span class="nav-icon">âš™ï¸</span>
        <span>Settings</span>
      </button>
    </nav>
  </div>

  <!-- Inline safety net: if app doesn't load in 8s, offer cache reset -->
  <script>
  (function() {
    var timer = setTimeout(function() {
      var el = document.getElementById('main-content');
      if (el && el.querySelector('p') && el.querySelector('p').textContent === 'Loading...') {
        el.innerHTML = '<div style="padding:30px 20px;text-align:center;">' +
          '<p style="color:#D32F2F;font-size:16px;margin-bottom:16px;">App failed to load.</p>' +
          '<button onclick="clearAndReload()" style="padding:12px 24px;background:#4285F4;color:#fff;border:none;border-radius:8px;font-size:16px;cursor:pointer;">Clear Cache & Reload</button>' +
          '<p style="color:#757575;font-size:13px;margin-top:12px;">This clears the service worker cache and reloads.</p>' +
          '</div>';
      }
    }, 8000);
    window._appSafetyTimer = timer;
    window.clearAndReload = function() {
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations().then(function(regs) {
          var promises = regs.map(function(r) { return r.unregister(); });
          return Promise.all(promises);
        }).then(function() {
          return caches.keys();
        }).then(function(names) {
          return Promise.all(names.map(function(n) { return caches.delete(n); }));
        }).then(function() {
          window.location.reload();
        });
      } else {
        window.location.reload();
      }
    };
  })();
  </script>

  <!-- Scripts -->
  <script src="./js/data.js"></script>
  <script src="./js/idb-storage.js"></script>
  <script src="./js/storage.js"></script>
  <script src="./js/app.js"></script>
</body>
</html>
